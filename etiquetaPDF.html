<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=40mm, height=50mm, initial-scale=1.0">
<title>Etiqueta 40x50mm</title>
<style>
    body {
        margin: 0;
        padding: 0;
        width: 40mm;
        height: 50mm;
        font-family: Arial, sans-serif;
        text-align: center;
        overflow: hidden;
    }

    #contenedor {
        width: 40mm;
        height: 50mm;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 1mm;
        box-sizing: border-box;
    }

    .fila-superior {
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
    }

    .logo {
        width: 12mm;
        height: auto;
    }

    .precio {
        font-size: 5mm;
        font-weight: bold;
        text-align: right;
        flex-grow: 1;
        padding-right: 2mm;
    }

    .nombre {
        margin-top: 2mm;
        font-size: 4mm;
        font-weight: bold;
    }

    .descripcion {
        margin-top: 1mm;
        font-size: 3mm;
    }

    .codigo-img {
        margin-top: 2mm;
        width: 20mm;
        height: auto;
    }

    .serial {
        margin-top: 1mm;
        font-size: 3mm;
        font-weight: bold;
    }
</style>
</head>
<body>
<div id="contenedor">

    <div class="fila-superior">
        <img id="logo" class="logo" src="" alt="Logo">
        <div id="precio" class="precio"></div>
    </div>

    <div id="nombre" class="nombre"></div>
    <div id="descripcion" class="descripcion"></div>

    <img id="codigo" class="codigo-img" src="" alt="CÃ³digo">
    <div id="serial" class="serial"></div>

</div>

<script>
    const params = new URLSearchParams(window.location.search);

    document.getElementById("logo").src = params.get("logo") || "";
    const precioValor = params.get("precio");
    const precioFormateado = precioValor ? Number(precioValor).toLocaleString('en-US', { maximumFractionDigits: 0 }) : "0";
    document.getElementById("precio").textContent = precioFormateado;
    document.getElementById("nombre").textContent = params.get("nombre") || "";
    document.getElementById("descripcion").textContent = params.get("descripcion") || "";
    document.getElementById("codigo").src = params.get("codigo") || "";
    document.getElementById("serial").textContent = params.get("serial") || "";
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
async function generarPDF() {
    const {{ jsPDF }} = window.jspdf;
    const pdf = new jsPDF({
        orientation: 'landscape',
        unit: 'mm',
        format: [50, 40]
    });

    const nombre = document.getElementById("nombre").textContent;
    const descripcion = document.getElementById("descripcion").textContent;
    const precio = document.getElementById("precio").textContent;
    const serial = document.getElementById("serial").textContent;

    const logo = document.getElementById("logoIMG");
    const codigo = document.getElementById("codigo");

    pdf.setFont('Helvetica', 'bold');
    pdf.setFontSize(14);
    pdf.text(precio, 48, 8, { align: 'right' });

    if (logo.src) {
        try {
            const logoImg = await getBase64(logo.src);
            pdf.addImage(logoImg, 'PNG', 2, 2, 12, 12);
        } catch {}
    }

    pdf.setFontSize(10);
    pdf.text(nombre, 25, 18, { align: 'center' });

    pdf.setFont('Helvetica', 'normal');
    pdf.setFontSize(8);
    pdf.text(descripcion, 25, 23, { align: 'center' });

    if (codigo.src) {
        try {
            const codImg = await getBase64(codigo.src);
            pdf.addImage(codImg, 'PNG', 15, 26, 20, 10);
        } catch {}
    }

    pdf.setFontSize(8);
    pdf.text(serial, 25, 38, { align: 'center' });

    pdf.output('dataurlnewwindow');
    window.close();
}

function getBase64(url) {
    return new Promise((resolve, reject) => {
        const img = new Image();
        img.crossOrigin = 'Anonymous';
        img.onload = function () {
            const canvas = document.createElement('canvas');
            canvas.width = this.width;
            canvas.height = this.height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(this, 0, 0);
            resolve(canvas.toDataURL('image/png'));
        };
        img.onerror = reject;
        img.src = url;
    });
}

window.onload = () => generarPDF();
</script>
</body>
</html>
